    {{!-- Content Column --}}
    <div class="col-md-10 col-md-offset-2 left-border main-content-container">
      <h1>Ember Table <small>Financial Table</small></h1>

      <div class="row">
        <div class="col-md-12">
          <div class="example-container">
            <div class="ember-table-example-container ember-table-financial">
              {{view App.FinancialTableExample.TableComponent dataBinding="data"}}
            </div>
          </div>
          <div class="example-description">
            <p class="reduced">Ember-Table with financial theme. Table with half a million rows.</p>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-12">
          <h3>Custom Table_Header_Tree_Cell.hbs</h3>
          <div class="highlight">
<pre class="prettyprint lang-html">&lt;div class="ember-table-cell-container"&gt;
  &lt;span &#123;&#123;bindAttr class=":ember-table-toggle-span view.row.isLeaf::ember-table-toggle
      view.row.isCollapsed:ember-table-expand:ember-table-collapse"&#125;&#125;
      &#123;&#123;action toggleCollapse view.row&#125;&#125;&gt;
    &lt;i class="icon-caret-down ember-table-toggle-icon"&gt;&lt;/i&gt;
  &lt;/span&gt;
  &lt;div class="ember-table-header-content-container" &#123;&#123;action sortByColumn view.column&#125;&#125;&gt;
    &lt;span class="ember-table-content"&gt;
      &#123;&#123;view.column.headerCellName&#125;&#125;
    &lt;/span&gt;
  &lt;/div&gt;
&lt;/div&gt;</pre>
          </div>
        </div>
      </div>

      <div class="row bumper-30">
        <div class="col-md-6">
          <h3>Custom Table_Cell_Container.hbs</h3>
          <div class="highlight">
<pre class="prettyprint lang-html">&lt;div class="ember-table-cell-container"&gt;
  &lt;span class="ember-table-content">
    &#123;&#123;view.cellContent&#125;&#125;
  &lt;/span&gt;
&lt;/div&gt;</pre>
          </div>
        </div>

        <div class="col-md-6">
          <h3>Custom Table_Cell_Container.hbs</h3>
          <div class="highlight">
<pre class="prettyprint lang-html"> &lt;div class="ember-table-cell-container"&gt;
   &lt;span class="ember-table-content"&gt;
    &#123;&#123;view.cellContent&#125;&#125;
   &lt;/span&gt;
 &lt;/div&gt;</pre>
          </div>
        </div>
      </div>

      <div class="row bumper-30">
        <div class="col-md-12">
          <h3>Financial table controller</h3>
          <div class="highlight">
<pre class="prettyprint lang-coffee">App.EmberTableOverviewController = Ember.Controller.extend
  data: Ember.computed -> App.data.treedata

Number.prototype.toCurrency = ->
  return '-' if isNaN(@) or not isFinite(@)
  value = Math.abs(@).toFixed(2)
  value = value.replace(/(\d)(?=(\d\d\d)+(?!\d))/g, '$1,')
  (if this < 0 then '-$' else '$') + value

Number.prototype.toPercent = ->
  return '-' if isNaN(@) or not isFinite(@)
  Math.abs(this * 100).toFixed(2) + '%'

App.FinancialTableExample = Ember.Namespace.create()


# Ember-Table: Data transformation

# Convert tree data into columns, bodyContent and footerContent for the table
App.FinancialTableExample.TreeDataAdapter = Ember.Mixin.create
  data: null

  columns: Ember.computed ->
    data = @get 'data'
    return unless data
    names = @get('data.value_factors').getEach('display_name')
    columns = names.map (name, index) ->
      Ember.Table.ColumnDefinition.create
        index: index
        headerCellName: name
        headerCellViewClass:  'App.FinancialTableExample.HeaderCell'
        tableCellViewClass:   'App.FinancialTableExample.TableCell'
        getCellContent: (row) ->
          object = row.values[@get('index')]
          return object.value.toCurrency() if object.type is 'money'
          return object.value.toPercent()  if object.type is 'percent'
          "-"
    columns.unshiftObject @get('groupingColumn')
    columns
  .property 'data.valueFactors.@each', 'groupingColumn'

  groupingColumn: Ember.computed ->
    groupingFactors = @get 'data.grouping_factors'
    name = groupingFactors.getEach('display_name').join ' â–¸ '
    Ember.Table.ColumnDefinition.create
      headerCellName: name
      columnWidth: 400
      isTreeColumn: yes
      isSortable: no
      textAlign: 'text-align-left'
      headerCellViewClass:  'App.FinancialTableExample.HeaderTreeCell'
      tableCellViewClass:   'App.FinancialTableExample.TreeCell'
      contentPath: 'group_value'
  .property 'data.grouping_factors.@each'

  root: Ember.computed ->
    data = @get 'data'
    return unless data
    @createTree(null, data.root)
  .property 'data', 'sortAscending', 'sortColumn'

  rows: Ember.computed ->
    root = @get 'root'
    return Ember.A() unless root
    rows = @flattenTree null, root, Ember.A()
    @computeStyles null, root
    maxGroupingLevel = Math.max.apply rows.getEach('groupingLevel')
    rows.forEach (row) -> row.computeRowStyle(maxGroupingLevel)
    rows
  .property 'root'

  # OPTIMIZATION HACK
  bodyContent: Ember.computed ->
    rows = @get('rows')
    return Ember.A() unless rows
    rows = rows.slice(1, rows.get('length'))
    rows.filterProperty('isShowing')
  .property 'rows'

  footerContent: Ember.computed ->
    rows = @get('rows')
    return Ember.A() unless rows
    rows.slice(0, 1)
  .property 'rows'

  orderBy: (item1, item2) ->
    sortColumn = @get 'sortColumn'
    sortAscending = @get 'sortAscending'
    return 1 unless sortColumn
    value1 = sortColumn.getCellContent item1.get('content')
    value2 = sortColumn.getCellContent item2.get('content')
    result = Ember.compare value1, value2
    if sortAscending then result else -result

  createTree: (parent, node) ->
    row = App.FinancialTableExample.TreeTableRow.create()
    children = (node.children || []).map (child) =>
      @createTree row, child
    # TODO(Peter): Hack... only collapse table if it should collapseByDefault
    # and it is not the root. Currently the total row is the root, and if it
    # is collapse, it causes nothing to show in the table and there is no way
    # to get expand it.
    row.setProperties
      isRoot:     not parent
      isLeaf:     Ember.isEmpty(children)
      content:    node
      parent:     parent
      children:   children
      groupName:  node.group_name
      isCollapsed:no
    row

  flattenTree: (parent, node, rows) ->
    rows.pushObject node
    (node.children || []).forEach (child) =>
      @flattenTree node, child, rows
    rows

  computeStyles: (parent, node) ->
    node.computeStyles parent
    node.get('children').forEach (child) =>
      @computeStyles node, child


# Ember-Table: Controller

App.FinancialTableExample.TableComponent =
Ember.Table.EmberTableComponent.extend App.FinancialTableExample.TreeDataAdapter,
  # overridding default properties
  numFixedColumns: 1
  isCollapsed: no
  isHeaderHeightResizable: yes
  rowHeight: 30
  hasHeader: yes
  hasFooter: yes
  headerHeight: 70

  # custom properties
  sortAscending: no
  sortColumn: null
  selection: null

  toggleTableCollapse: (event) ->
    @toggleProperty 'isCollapsed'
    isCollapsed = @get 'isCollapsed'
    children = @get('root.children')
    return unless children and children.get('length') > 0
    children.forEach (child) -> child.recursiveCollapse isCollapsed
    @notifyPropertyChange 'rows'

  toggleCollapse: (row) ->
    row.toggleProperty 'isCollapsed'
    Ember.run.next this, -> @notifyPropertyChange 'rows'

  sortByColumn: (column) ->
    column.toggleProperty 'sortAscending'
    @set 'sortColumn', column
    @set 'sortAscending', column.get('sortAscending')

  onSelectionsDidChange: Ember.observer ->
    console.log 'selectionsDidChange'
  , 'selection.@each'
</pre>
          </div>
        </div>
      </div>
    </div>
